<div class="h-full">
<header class="text-gray-600 body-font bg-blue-600">
        <div class="container mx-auto flex flex-wrap p-1 flex-col md:flex-row items-center">
            <a href="/" class="flex title-font font-medium items-center text-black mb-4 md:mb-0">
            <img src="../img/logo.png" alt="Logo" class="w-20 h-20 text-white p-2">
            <span class="ml-3 text-xl">JO Paris 2024</span></a>
            <nav class="md:ml-auto flex flex-wrap items-center text-black justify-center">
            <a href="/event/all" class="mr-5 hover:text-gray-900">Liste Complète</a>
            <a href="/user/account" id="accountButton" class="mr-5 hover:text-gray-900 hidden">Mon Compte</a>
            <a href="/admin/account" id="adminButton" class="mr-5 hover:text-red-900 hidden">Administration</a>
            <a href="/user/signin" id="loginButton" class="mr-5 hover:text-gray-900">S'identifier</a>
            <a href="/admin/newEvent" id="adminAccount" class="mr-5 hover:text-gray-900 hidden">Admin</a>
            <a href="#" id="logoutButton" onclick="logout()" class="mr-5 hover:text-gray-900 hidden">Déconnexion</a>
            </nav>
            <a href="/user/cart" id="cart" class="inline-flex items-center bg-gray-100 border-0 py-1 px-3 focus:outline-none hover:bg-gray-200 rounded text-base mt-4 md:mt-0">Panier
            </a>

        </div>

<script>
    // Fonction pour décoder un token JWT
    function parseJwt(token) {
        try {
            const base64Url = token.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(
                atob(base64)
                    .split('')
                    .map(function (c) {
                        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                    })
                    .join('')
            );
            console.log("Token décodé :", jsonPayload);
            return JSON.parse(jsonPayload);
        } catch (e) {
            console.error("Erreur lors du décodage du token :", e);
            return null;
        }
    }

    // Vérifier si l'utilisateur est connecté et a le rôle USER
    function updateHeaderButtons() {
        const token = localStorage.getItem("jwtToken"); // Récupère le token JWT depuis le localStorage

        if (token) {
            const decodedToken = parseJwt(token); // Décode le token JWT
            const roles = decodedToken?.role?.map(r => r.authority) || []; // Récupère les rôles (assurez-vous que le backend inclut les rôles dans le token)

            console.log("Rôles de l'utilisateur :", roles);
            
            // Afficher les boutons pour les utilisateurs connectés
            document.getElementById("logoutButton").classList.remove("hidden");

            // Afficher le bouton "Mon Compte" uniquement si l'utilisateur a le rôle USER
            if (roles.includes("ROLE_USER")) {
                console.log("L'utilisateur a le rôle USER");
                document.getElementById("accountButton").classList.remove("hidden");
            }

            // Afficher le bouton "Admin" uniquement si l'utilisateur a le rôle ADMIN
            if (roles.includes("ROLE_ADMIN")) {
                console.log("L'utilisateur a le rôle ADMIN");
                document.getElementById("adminButton").classList.remove("hidden");
            }

            // Masquer le bouton "Connexion"
            document.getElementById("loginButton").classList.add("hidden");
        } else {
            // Si l'utilisateur n'est pas connecté, afficher uniquement le bouton "Connexion"
            document.getElementById("loginButton").classList.remove("hidden");
            document.getElementById("logoutButton").classList.add("hidden");
            document.getElementById("adminButton").classList.add("hidden");
        }
        
        const panier = localStorage.getItem("panier");
        if (panier) {
            const panierItems = JSON.parse(panier);
            const totalItems = panierItems.reduce((total, item) => total + item.quantite, 0);
            document.getElementById("cart").textContent = `Panier (${totalItems})`;
        } else {
            document.getElementById("cart").textContent = "Panier";
        }
    }

    // Appeler la fonction pour mettre à jour les boutons du header
    updateHeaderButtons();

    // Ajouter un gestionnaire pour le bouton de déconnexion
    document.getElementById("logoutButton").addEventListener("click", function () {
        localStorage.removeItem("jwtToken"); // Supprime le token JWT du localStorage
        window.location.href = "/"; // Redirige vers la page d'accueil
    });
</script>
</header>